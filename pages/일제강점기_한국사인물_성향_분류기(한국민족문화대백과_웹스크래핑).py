# -*- coding: utf-8 -*-
"""ì¼ì œê°•ì ê¸° í•œêµ­ì‚¬ì¸ë¬¼ ì„±í–¥ ë¶„ë¥˜ê¸°(í•œêµ­ë¯¼ì¡±ë¬¸í™”ëŒ€ë°±ê³¼ ì›¹ìŠ¤í¬ë˜í•‘).ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/11J9Eeuzwu6Cmqb6f_z19cFjmo7pwW8y4
"""

# [1] ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°•ì œ ì—…ë°ì´íŠ¸ (ì´ ì½”ë“œë¥¼ ê°€ì¥ ë¨¼ì € ì‹¤í–‰í•´ì•¼ 404 ì˜¤ë¥˜ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤)
!pip install -U google-generativeai requests beautifulsoup4

import google.generativeai as genai
import requests
from bs4 import BeautifulSoup
import random
import json
import time
import os
import streamlit as st  # ì´ ì¤„ì´ ì—†ìœ¼ë©´ ë§¨ ìœ„ì— ì¶”ê°€í•´ì£¼ì„¸ìš”!

# ì´ì œ ì‹¤ì œ í‚¤ ëŒ€ì‹  'ë¹„ë°€ ê¸ˆê³ 'ë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤
GOOGLE_API_KEY = st.secrets["GEMINI_API_KEY"]
genai.configure(api_key=GOOGLE_API_KEY)


# ëª¨ë¸ ì„¤ì • (í˜¹ì‹œ flash ëª¨ë¸ì´ ì•ˆ ë˜ë©´ pro ëª¨ë¸ë¡œ ìë™ ì „í™˜í•˜ë„ë¡ ì˜ˆì™¸ì²˜ë¦¬ ì¶”ê°€í•¨)
def get_model():
    try:
        model = genai.GenerativeModel('gemini-2.5-flash')
        return model
    except:
        print("âš ï¸ Flash ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨, ê¸°ë³¸ Pro ëª¨ë¸ë¡œ ì „í™˜í•©ë‹ˆë‹¤.")
        return genai.GenerativeModel('gemini-pro')

model = get_model()

# =========================================================
# 3. ì›¹ ìŠ¤í¬ë˜í•‘ í•¨ìˆ˜
# =========================================================
def scrap_history_data(name):
    print(f"ğŸ” '{name}'ì— ëŒ€í•œ ìë£Œë¥¼ í•œêµ­ë¯¼ì¡±ë¬¸í™”ëŒ€ë°±ê³¼ì—ì„œ ì°¾ëŠ” ì¤‘...")
    url = f"https://encykorea.aks.ac.kr/Article/Search/{name}"

    try:
        headers = {'User-Agent': 'Mozilla/5.0'}
        response = requests.get(url, headers=headers)
        if response.status_code != 200: return None
        soup = BeautifulSoup(response.text, 'html.parser')
        text_content = soup.get_text()
        return text_content[:5000] # ë„ˆë¬´ ê¸¸ë©´ ìë¦„
    except Exception as e:
        print(f"âŒ ìŠ¤í¬ë˜í•‘ ì˜¤ë¥˜: {e}")
        return None

# =========================================================
# 4. AI ë¶„ë¥˜ í•¨ìˆ˜
# =========================================================
def classify_figure_with_ai(name, context_text):
    print(f"ğŸ¤– AIê°€ '{name}'ì˜ ì„±í–¥ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...")

    prompt = f"""
    ë‹¹ì‹ ì€ í•œêµ­ì‚¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì•„ë˜ [í…ìŠ¤íŠ¸]ëŠ” '{name}'ì— ëŒ€í•œ ìë£Œì…ë‹ˆë‹¤.
    ì´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì´ ì¸ë¬¼ì˜ ì„±í–¥ì„ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¡œ ë¶„ë¥˜í•˜ê³  ì´ìœ ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”.

    [ë¶„ë¥˜ ê¸°ì¤€]
    1. ë¬´ì¥íˆ¬ìŸë¡  (ë¬´ë ¥ ë…ë¦½ ìš´ë™)
    2. ì‹¤ë ¥ì–‘ì„±ë¡  (êµìœ¡/ì‚°ì—… ìœ¡ì„±)
    3. ì™¸êµë¡  (êµ­ì œ ì‚¬íšŒ í˜¸ì†Œ)
    4. ì¹œì¼íŒŒ (ë°˜ë¯¼ì¡± í–‰ìœ„)
    5. ê¸°íƒ€ (í•´ë‹¹ ì—†ìŒ)

    [ì¶œë ¥ í˜•ì‹ - JSON]
    {{
        "name": "{name}",
        "classification": "ë¶„ë¥˜ ê²°ê³¼",
        "reason": "íŒë‹¨ ì´ìœ  í•œ ì¤„ ìš”ì•½"
    }}

    [í…ìŠ¤íŠ¸]
    {context_text}
    """

    try:
        response = model.generate_content(prompt)
        # JSON í˜•ì‹ ì •ì œ
        text = response.text.replace("```json", "").replace("```", "").strip()
        return json.loads(text)
    except Exception as e:
        print(f"âŒ AI ì‘ë‹µ ì˜¤ë¥˜: {e}")
        return None

# =========================================================
# 5. ë©”ì¸ ì‹¤í–‰ (ì…ë ¥ ë¡œì§ ìˆ˜ì •ë¨)
# =========================================================
def main():
    history_figures = ["ê¹€êµ¬", "ì•ˆì°½í˜¸", "ì´ìŠ¹ë§Œ", "ì´ì™„ìš©", "ê¹€ì›ë´‰", "ì‹ ì±„í˜¸", "ìœ¤ë´‰ê¸¸"]

    print("\n" + "="*50)
    print("   ğŸš€ AI í•œêµ­ì‚¬ ì¸ë¬¼ ì„±í–¥ ë¶„ë¥˜ê¸° (ìˆ˜ì •ë²„ì „)")
    print("="*50)

    while True:
        # ì„ ìƒë‹˜ì˜ ì˜ë„ëŒ€ë¡œ ì…ë ¥ì„ ë°›ë„ë¡ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.
        user_input = input("\nğŸ‘‰ ì¸ë¬¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ê·¸ëƒ¥ ì—”í„°ì¹˜ë©´ ëœë¤, 'q'ëŠ” ì¢…ë£Œ): ").strip()

        if user_input.lower() == 'q':
            print("í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
            break

        # ì…ë ¥ê°’ì´ ìˆìœ¼ë©´ ê·¸ ì‚¬ëŒì„, ì—†ìœ¼ë©´ ëœë¤ìœ¼ë¡œ ì„ íƒ
        if user_input:
            target_person = user_input
        else:
            target_person = random.choice(history_figures)

        print(f"\nğŸ¯ ë¶„ì„ ëŒ€ìƒ: [{target_person}]")

        # ìë£Œ ìˆ˜ì§‘
        scraped_text = scrap_history_data(target_person)

        if not scraped_text or len(scraped_text) < 50:
            print("âš  ìë£Œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì˜¬ë°”ë¥¸ ì¸ë¬¼ëª…ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.")
            continue

        # AI ë¶„ì„
        result = classify_figure_with_ai(target_person, scraped_text)

        if result:
            print("-" * 40)
            print(f" ğŸ·ï¸  ì´ë¦„: {result.get('name')}")
            print(f" ğŸš© ì„±í–¥: {result.get('classification')}")
            print(f" ğŸ’¡ ì´ìœ : {result.get('reason')}")
            print("-" * 40)

        time.sleep(1)

if __name__ == "__main__":
    main()
