# -*- coding: utf-8 -*-
"""ê°œí™”íŒŒì™€ ìœ„ì •ì²™ì‚¬íŒŒ ë¶„ë¥˜ê¸°.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1d77zl8FQXiCzrV8d_POfAit0-9N8CHfu
"""

pip install requests beautifulsoup4 google-generativeai

import requests
from bs4 import BeautifulSoup
import google.generativeai as genai
import sys
import streamlit as st  # ì´ ì¤„ì´ ì—†ìœ¼ë©´ ë§¨ ìœ„ì— ì¶”ê°€í•´ì£¼ì„¸ìš”!

# ì´ì œ ì‹¤ì œ í‚¤ ëŒ€ì‹  'ë¹„ë°€ ê¸ˆê³ 'ë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤
GOOGLE_API_KEY = st.secrets["GEMINI_API_KEY"]
genai.configure(api_key=GOOGLE_API_KEY)

# ëª¨ë¸ ì„¤ì • (ê°€ë³ê³  ë¹ ë¥¸ gemini-1.5-flash ì‚¬ìš© ê¶Œì¥)
model = genai.GenerativeModel('gemini-2.5-flash')

# ---------------------------------------------------------
# 2. ì›¹ ìŠ¤í¬ë˜í•‘ ëª¨ë“ˆ (êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒ ë°ì´í„°ë² ì´ìŠ¤)
# ---------------------------------------------------------
def scrape_history_data(name):
    """
    êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒ í•œêµ­ì‚¬ë°ì´í„°ë² ì´ìŠ¤ í†µí•©ê²€ìƒ‰ì—ì„œ ì¸ë¬¼ ê´€ë ¨ í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
    """
    print(f"ğŸ” êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒ DBì—ì„œ '{name}' ê´€ë ¨ ì‚¬ë£Œë¥¼ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...")

    # êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒ í†µí•©ê²€ìƒ‰ URL
    # ì‹¤ì œ ë°ì´í„° êµ¬ì¡°ì— ë”°ë¼ URLì´ë‚˜ íŒŒë¼ë¯¸í„°ëŠ” ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    base_url = "http://db.history.go.kr/integrated/search/searchResult.do"
    params = {
        'keyword': name,
        'itemIds': '300', # ì¸ë¬¼/ì‹œëŒ€ ê´€ë ¨ ì¹´í…Œê³ ë¦¬ (í•„ìš”ì‹œ ì¡°ì •)
    }

    try:
        # íƒ€ì„ì•„ì›ƒ ì„¤ì • (ì„œë²„ ì‘ë‹µ ì§€ì—° ëŒ€ë¹„)
        response = requests.get(base_url, params=params, timeout=10)
        response.raise_for_status()

        soup = BeautifulSoup(response.text, 'html.parser')

        # ê²€ìƒ‰ ê²°ê³¼ í…ìŠ¤íŠ¸ ì¶”ì¶œ
        # (ì‚¬ì´íŠ¸ êµ¬ì¡° ë³€ê²½ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘í•˜ê¸° ìœ„í•´ ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ì˜ í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤)
        results = []

        # ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ (dl, li ë“± ì¼ë°˜ì ì¸ ëª©ë¡ íƒœê·¸ íƒìƒ‰)
        contents = soup.select('.search_result li dl dd')

        if not contents:
            # ë‹¤ë¥¸ êµ¬ì¡°ì¼ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ì˜ˆë¹„ ì„ íƒì
            contents = soup.select('.ul_list li')

        for content in contents[:4]: # í† í° ì ˆì•½ì„ ìœ„í•´ ìƒìœ„ 4ê°œ ê²°ê³¼ë§Œ ì‚¬ìš©
            text = content.get_text(strip=True)
            if len(text) > 30: # ë„ˆë¬´ ì§§ì€ ë…¸ì´ì¦ˆ ë°ì´í„° ì œì™¸
                results.append(text)

        if not results:
            return None

        # ë¦¬ìŠ¤íŠ¸ë¥¼ í•˜ë‚˜ì˜ ë¬¸ìì—´ë¡œ í•©ì¹¨
        return " ".join(results)

    except Exception as e:
        print(f"âš ï¸ ìŠ¤í¬ë˜í•‘ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
        return None

# ---------------------------------------------------------
# 3. ë¶„ë¥˜ ëª¨ë¸ ëª¨ë“ˆ (Gemini API í™œìš©)
# ---------------------------------------------------------
def classify_figure(name, context_text):
    """
    ìˆ˜ì§‘ëœ í…ìŠ¤íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ Gemini ëª¨ë¸ì„ í†µí•´ ê°œí™”íŒŒ/ìœ„ì •ì²™ì‚¬íŒŒë¥¼ ë¶„ë¥˜í•©ë‹ˆë‹¤.
    """
    if not context_text:
        return "ì •ë³´ ë¶€ì¡±ìœ¼ë¡œ íŒë‹¨ ë¶ˆê°€"

    print("ğŸ¤– Geminiê°€ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...")

    # í”„ë¡¬í”„íŠ¸ êµ¬ì„±
    prompt = f"""
    ë‹¹ì‹ ì€ í•œêµ­ ê·¼ëŒ€ì‚¬ ì—­ì‚¬í•™ìì…ë‹ˆë‹¤.
    ì•„ë˜ ì œê³µëœ 'êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒ ê²€ìƒ‰ ê²°ê³¼(í…ìŠ¤íŠ¸)'ë¥¼ ë°”íƒ•ìœ¼ë¡œ, '{name}'ì´ë¼ëŠ” ì¸ë¬¼ì˜ ì •ì¹˜/ì‚¬ìƒì  ì„±í–¥ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.

    [ë¶„ë¥˜ ê¸°ì¤€]
    1. **ê°œí™”íŒŒ (Enlightenment Party)**: ë¬¸í˜¸ ê°œë°©, ê·¼ëŒ€í™” ì¶”ì§„, ì„œì–‘/ì¼ë³¸ ë¬¸ë¬¼ ìˆ˜ìš© ì£¼ì¥.
    2. **ìœ„ì •ì²™ì‚¬íŒŒ (Orthodoxy Party)**: ì„±ë¦¬í•™ì  ì§ˆì„œ ìˆ˜í˜¸, í†µìƒ ë°˜ëŒ€, ì™¸ì„¸ ë°°ê²© ì£¼ì¥.
    3. **ê¸°íƒ€/ì¤‘ë¦½**: ìœ„ ë‘ íŒŒë²Œì— ëª…í™•íˆ ì†í•˜ì§€ ì•Šê±°ë‚˜ íŒë‹¨í•˜ê¸° ì–´ë ¤ìš´ ê²½ìš°.

    [ì œê³µëœ í…ìŠ¤íŠ¸]
    {context_text[:2000]}

    [ì‘ë‹µ í˜•ì‹]
    ë°˜ë“œì‹œ ì•„ë˜ í˜•ì‹ì„ ì§€ì¼œì£¼ì„¸ìš”:
    - **ë¶„ë¥˜**: [ê°œí™”íŒŒ / ìœ„ì •ì²™ì‚¬íŒŒ / ê¸°íƒ€ ì¤‘ íƒ1]
    - **ì‹ ë¢°ë„**: [ìƒ / ì¤‘ / í•˜]
    - **í•µì‹¬ ê·¼ê±°**: [í…ìŠ¤íŠ¸ì— ê¸°ë°˜í•œ 1~2ë¬¸ì¥ ìš”ì•½]
    """

    try:
        # Gemini ëª¨ë¸ í˜¸ì¶œ
        response = model.generate_content(prompt)
        return response.text

    except Exception as e:
        return f"âš ï¸ API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}"

# ---------------------------------------------------------
# 4. ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜
# ---------------------------------------------------------
def main():
    print("\n" + "="*50)
    print("   ğŸ›ï¸  ì—­ì‚¬ ì¸ë¬¼ ì„±í–¥ ë¶„ë¥˜ê¸° (Powered by Google Gemini)   ")
    print("="*50)

    while True:
        target_name = input("\nğŸ“ ë¶„ë¥˜í•  ì¸ë¬¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” ('q' ì…ë ¥ ì‹œ ì¢…ë£Œ): ").strip()

        if target_name.lower() == 'q':
            print("í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
            break

        if not target_name:
            continue

        # 1. ë°ì´í„° ìˆ˜ì§‘ (Scraping)
        history_context = scrape_history_data(target_name)

        # 2. ëª¨ë¸ ë¶„ë¥˜ (Inference)
        if history_context:
            result = classify_figure(target_name, history_context)
            print("\n" + "-"*50)
            print(f"ğŸ“Š [ë¶„ì„ ê²°ê³¼] : {target_name}")
            print("-" * 50)
            print(result)
            print("-" * 50)
        else:
            print(f"âŒ '{target_name}'ì— ëŒ€í•œ ìœ ì˜ë¯¸í•œ ì‚¬ë£Œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ê²€ìƒ‰ì–´ í™•ì¸ í•„ìš”)")

if __name__ == "__main__":
    main()

import requests
from bs4 import BeautifulSoup
import google.generativeai as genai
import sys
import time

# ---------------------------------------------------------
# 1. ì„¤ì • ë° ì´ˆê¸°í™”
# ---------------------------------------------------------
# ì´ì œ ì‹¤ì œ í‚¤ ëŒ€ì‹  'ë¹„ë°€ ê¸ˆê³ 'ë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤
GOOGLE_API_KEY = st.secrets["GEMINI_API_KEY"]
genai.configure(api_key=GOOGLE_API_KEY)

try:
    genai.configure(api_key=GOOGLE_API_KEY)
    # 1.5-flash ëª¨ë¸ ì‚¬ìš© (ì†ë„ê°€ ë¹ ë¦„)
    model = genai.GenerativeModel('gemini-1.5-flash')
except Exception as e:
    print(f"âš ï¸ API ì„¤ì • ì˜¤ë¥˜: {e}")
    print("API í‚¤ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.")
    sys.exit()

# ---------------------------------------------------------
# 2. ì›¹ ìŠ¤í¬ë˜í•‘ ëª¨ë“ˆ (í—¤ë” ì¶”ê°€ë¡œ ì°¨ë‹¨ ìš°íšŒ)
# ---------------------------------------------------------
def scrape_history_data(name):
    """
    êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒ í†µí•©ê²€ìƒ‰ì—ì„œ ì¸ë¬¼ ê´€ë ¨ í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
    User-Agentë¥¼ ì¶”ê°€í•˜ì—¬ 400 ì—ëŸ¬ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.
    """
    print(f"ğŸ” êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒ DBì—ì„œ '{name}' ê´€ë ¨ ì‚¬ë£Œë¥¼ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...")

    # í†µí•©ê²€ìƒ‰ URL
    base_url = "http://db.history.go.kr/integrated/search/searchResult.do"

    # [ì¤‘ìš”] ë¸Œë¼ìš°ì €ì¸ ì²™ ìœ„ì¥í•˜ê¸° ìœ„í•œ í—¤ë” ì„¤ì •
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
        'Referer': 'http://db.history.go.kr/',
        'Accept-Language': 'ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7'
    }

    params = {
        'keyword': name,
        'itemIds': '300', # ì¸ë¬¼ ê´€ë ¨ (ì˜¤ë¥˜ ë°œìƒ ì‹œ ì´ ì¤„ì„ ì£¼ì„ ì²˜ë¦¬í•´ë³´ì„¸ìš”)
    }

    try:
        # headers ì˜µì…˜ ì¶”ê°€
        response = requests.get(base_url, params=params, headers=headers, timeout=10)
        response.raise_for_status() # 400/500 ì—ëŸ¬ ë°œìƒ ì‹œ ì˜ˆì™¸ ì²˜ë¦¬

        soup = BeautifulSoup(response.text, 'html.parser')

        results = []

        # ì‚¬ì´íŠ¸ êµ¬ì¡°ì— ë§ì¶° í…ìŠ¤íŠ¸ ì¶”ì¶œ (êµ¬ì¡°ê°€ ìœ ë™ì ì´ë¯€ë¡œ ì—¬ëŸ¬ ì„ íƒì ì‹œë„)
        # 1. ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ìš”ì•½ ë‚´ìš©
        contents = soup.select('.search_result li dl dd')

        # 2. ë§Œì•½ ìœ„ ì„ íƒìë¡œ ëª» ì°¾ìœ¼ë©´ ë‹¤ë¥¸ í´ë˜ìŠ¤ ì‹œë„
        if not contents:
            contents = soup.select('.cont_list li .txt')

        for content in contents[:5]:
            text = content.get_text(strip=True)
            if len(text) > 20:
                results.append(text)

        if not results:
            print(f"   â„¹ï¸ ê²€ìƒ‰ ê²°ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (í˜ì´ì§€ êµ¬ì¡°ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)")
            return None

        return " ".join(results)

    except requests.exceptions.HTTPError as e:
        print(f"âš ï¸ HTTP ì˜¤ë¥˜ ë°œìƒ (400/500): {e}")
        print("   -> ì„œë²„ê°€ ìš”ì²­ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ í—¤ë”ë¥¼ í™•ì¸í•˜ì„¸ìš”.")
        return None
    except Exception as e:
        print(f"âš ï¸ ê¸°íƒ€ ìŠ¤í¬ë˜í•‘ ì˜¤ë¥˜: {e}")
        return None

# ---------------------------------------------------------
# 3. ë¶„ë¥˜ ëª¨ë¸ ëª¨ë“ˆ
# ---------------------------------------------------------
def classify_figure(name, context_text):
    if not context_text:
        return "ì •ë³´ ë¶€ì¡±ìœ¼ë¡œ íŒë‹¨ ë¶ˆê°€"

    print("ğŸ¤– Geminiê°€ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...")

    prompt = f"""
    ë‹¹ì‹ ì€ í•œêµ­ì‚¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
    ì•„ë˜ ì œê³µëœ í…ìŠ¤íŠ¸ëŠ” êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒì—ì„œ '{name}'ìœ¼ë¡œ ê²€ìƒ‰ëœ ê²°ê³¼ì…ë‹ˆë‹¤.
    ì´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì´ ì¸ë¬¼ì´ 'ê°œí™”íŒŒ'ì¸ì§€ 'ìœ„ì •ì²™ì‚¬íŒŒ'ì¸ì§€ ë¶„ë¥˜í•´ì£¼ì„¸ìš”.

    [ì œê³µëœ í…ìŠ¤íŠ¸]
    {context_text[:2000]}

    [ì‘ë‹µ í˜•ì‹]
    - **ë¶„ë¥˜**: [ê°œí™”íŒŒ / ìœ„ì •ì²™ì‚¬íŒŒ / ê¸°íƒ€]
    - **ì´ìœ **: [í…ìŠ¤íŠ¸ì— ê¸°ë°˜í•œ 1ë¬¸ì¥ ìš”ì•½]
    """

    try:
        response = model.generate_content(prompt)
        return response.text
    except Exception as e:
        return f"âš ï¸ API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}"

# ---------------------------------------------------------
# 4. ë©”ì¸ ì‹¤í–‰
# ---------------------------------------------------------
def main():
    print("\n" + "="*50)
    print("   ğŸ›ï¸  ì—­ì‚¬ ì¸ë¬¼ ì„±í–¥ ë¶„ë¥˜ê¸° (ìˆ˜ì •ë²„ì „)   ")
    print("="*50)

    while True:
        target_name = input("\nğŸ“ ì¸ë¬¼ ì´ë¦„ ì…ë ¥ ('q' ì¢…ë£Œ): ").strip()

        if target_name.lower() == 'q':
            print("ì¢…ë£Œí•©ë‹ˆë‹¤.")
            break

        if not target_name:
            continue

        # 1. ìˆ˜ì§‘
        history_context = scrape_history_data(target_name)

        # 2. ë¶„ì„
        if history_context:
            result = classify_figure(target_name, history_context)
            print("\n" + "-"*50)
            print(f"ğŸ“Š ê²°ê³¼: {target_name}")
            print(result)
            print("-" * 50)
        else:
            print(f"âŒ '{target_name}' ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í•´ ë¶„ì„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

if __name__ == "__main__":
    main()

import requests
from bs4 import BeautifulSoup
import google.generativeai as genai
import sys
import warnings

# ---------------------------------------------------------
# 1. ì„¤ì • ë° ì´ˆê¸°í™”
# ---------------------------------------------------------
# ê²½ê³  ë©”ì‹œì§€(FutureWarning) ìˆ¨ê¸°ê¸° (ê¹”ë”í•œ ì¶œë ¥ì„ ìœ„í•´)
warnings.filterwarnings("ignore")

# Google AI Studio API KEY ì…ë ¥
GOOGLE_API_KEY = "AIzaSyBEmAHr7r1i2mt8yu6qjp3P79ErIfQrIfw"

try:
    genai.configure(api_key=GOOGLE_API_KEY)
    model = genai.GenerativeModel('gemini-2.5-flash')
except Exception as e:
    print(f"âš ï¸ API ì„¤ì • ì˜¤ë¥˜: {e}")
    sys.exit()

# ---------------------------------------------------------
# 2. ì›¹ ìŠ¤í¬ë˜í•‘ ëª¨ë“ˆ (ìµœì‹  URL ì ìš©)
# ---------------------------------------------------------
def scrape_history_data(name):
    """
    êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒ í•œêµ­ì‚¬ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¸ë¬¼ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
    (ìµœì‹  HTTPS ì£¼ì†Œ ë° íŒŒë¼ë¯¸í„° ì ìš©)
    """
    print(f"ğŸ” êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒ DBì—ì„œ '{name}' ê²€ìƒ‰ ì¤‘...")

    # [ìˆ˜ì •ë¨] ìµœì‹  ê²€ìƒ‰ URL (HTTPS ì ìš©)
    base_url = "https://db.history.go.kr/search/searchResult.do"

    # [ìˆ˜ì •ë¨] ë¸Œë¼ìš°ì € ìœ„ì¥ í—¤ë”
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
        'Referer': 'https://db.history.go.kr/',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'
    }

    # [ìˆ˜ì •ë¨] íŒŒë¼ë¯¸í„° ì´ë¦„ ë³€ê²½ (keyword -> searchKeyword)
    params = {
        'searchKeyword': name,
        'sort': 'levelId',  # ì •í™•ë„/ì¤‘ìš”ë„ ìˆœ ì •ë ¬ ìœ ë„
        'limit': '20'
    }

    try:
        # verify=FalseëŠ” SSL ì¸ì¦ì„œ ì˜¤ë¥˜ ë°©ì§€ (í•„ìš” ì‹œ ì‚¬ìš©)
        response = requests.get(base_url, params=params, headers=headers, timeout=10)

        # 404, 500 ë“± ì—ëŸ¬ ì²´í¬
        if response.status_code == 404:
            print("âŒ ì˜¤ë¥˜: í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (URL ë³€ê²½ë¨).")
            return None
        response.raise_for_status()

        soup = BeautifulSoup(response.text, 'html.parser')

        results = []

        # [ìˆ˜ì •ë¨] ì‹¤ì œ ì‚¬ì´íŠ¸ êµ¬ì¡°ì— ë§ëŠ” ì„ íƒì (ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸)
        # 1. <ul> ë¦¬ìŠ¤íŠ¸ ì•ˆì˜ <li> í…ìŠ¤íŠ¸ ì¶”ì¶œ ì‹œë„
        list_items = soup.select('.search_list li .cont')

        # 2. ë§Œì•½ êµ¬ì¡°ê°€ ë‹¤ë¥´ë©´ ë‹¤ë¥¸ í´ë˜ìŠ¤ ì‹œë„
        if not list_items:
            list_items = soup.select('.result_list li')

        for item in list_items[:3]: # ìƒìœ„ 3ê°œë§Œ ì¶”ì¶œ
            text = item.get_text(strip=True)
            if len(text) > 30: # ë„ˆë¬´ ì§§ì€ ì œëª© ë“±ì€ ì œì™¸
                results.append(text)

        # ê²°ê³¼ê°€ ì—†ì„ ê²½ìš°
        if not results:
            # ì¸ë¬¼ì´ ê²€ìƒ‰ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ê²°ê³¼ í…ìŠ¤íŠ¸ë¥¼ ëª» ì°¾ì€ ê²½ìš°
            print("   â„¹ï¸ ê²€ìƒ‰ ê²°ê³¼ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.")
            return None

        return " ".join(results)

    except requests.exceptions.HTTPError as e:
        print(f"âš ï¸ HTTP ì˜¤ë¥˜ ({response.status_code}): {e}")
        return None
    except Exception as e:
        print(f"âš ï¸ ìŠ¤í¬ë˜í•‘ ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜: {e}")
        return None

# ---------------------------------------------------------
# 3. ë¶„ë¥˜ ëª¨ë¸ ëª¨ë“ˆ
# ---------------------------------------------------------
def classify_figure(name, context_text):
    if not context_text:
        return "ë°ì´í„° ë¶€ì¡±ìœ¼ë¡œ ë¶„ì„ ë¶ˆê°€"

    print("ğŸ¤– Geminiê°€ ì‚¬ë£Œë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...")

    prompt = f"""
    ë‹¹ì‹ ì€ í•œêµ­ì‚¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
    ì•„ë˜ êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒ ê²€ìƒ‰ ê²°ê³¼(í…ìŠ¤íŠ¸)ë¥¼ ë°”íƒ•ìœ¼ë¡œ '{name}'ì˜ ì„±í–¥ì„ ë¶„ì„í•˜ì„¸ìš”.

    [ë¶„ì„ ìš”ì²­]
    ì´ ì¸ë¬¼ì´ 'ê°œí™”íŒŒ(Enlightenment)'ì¸ì§€ 'ìœ„ì •ì²™ì‚¬íŒŒ(Orthodoxy)'ì¸ì§€ ë¶„ë¥˜í•´ì£¼ì„¸ìš”.

    [í…ìŠ¤íŠ¸]
    {context_text[:2500]}

    [ì¶œë ¥ í˜•ì‹]
    - **ë¶„ë¥˜**: [ê°œí™”íŒŒ / ìœ„ì •ì²™ì‚¬íŒŒ / ì¤‘ë¦½ ë˜ëŠ” ê¸°íƒ€]
    - **í•µì‹¬ ê·¼ê±°**: [í…ìŠ¤íŠ¸ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ë¬¸ì¥ ìš”ì•½]
    """

    try:
        response = model.generate_content(prompt)
        return response.text
    except Exception as e:
        return f"âš ï¸ ë¶„ì„ ì¤‘ ì˜¤ë¥˜: {e}"

# ---------------------------------------------------------
# 4. ë©”ì¸ ì‹¤í–‰
# ---------------------------------------------------------
def main():
    print("\n" + "="*50)
    print("   ğŸ›ï¸  ì—­ì‚¬ ì¸ë¬¼ ì„±í–¥ ë¶„ë¥˜ê¸° (v2.0 Fix)   ")
    print("="*50)

    while True:
        target_name = input("\nğŸ“ ì¸ë¬¼ ì´ë¦„ ì…ë ¥ ('q' ì¢…ë£Œ): ").strip()

        if target_name.lower() == 'q':
            print("ì¢…ë£Œí•©ë‹ˆë‹¤.")
            break

        if not target_name:
            continue

        # 1. ìˆ˜ì§‘
        history_context = scrape_history_data(target_name)

        # 2. ë¶„ì„
        if history_context:
            result = classify_figure(target_name, history_context)
            print("\n" + "-"*50)
            print(f"ğŸ“Š ê²°ê³¼: {target_name}")
            print(result)
            print("-" * 50)
        else:
            print(f"âŒ '{target_name}'ì— ëŒ€í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

if __name__ == "__main__":
    main()

import requests
from bs4 import BeautifulSoup
import google.generativeai as genai
import sys
import warnings

# ---------------------------------------------------------
# 1. ì„¤ì • ë° ì´ˆê¸°í™”
# ---------------------------------------------------------
warnings.filterwarnings("ignore") # ë¶ˆí•„ìš”í•œ ê²½ê³  ìˆ¨ê¸°ê¸°

# êµ¬ê¸€ AI ìŠ¤íŠœë””ì˜¤ API í‚¤ ì…ë ¥
GOOGLE_API_KEY = "AIzaSyBEmAHr7r1i2mt8yu6qjp3P79ErIfQrIfw"

try:
    genai.configure(api_key=GOOGLE_API_KEY)
    model = genai.GenerativeModel('gemini-2.5-flash')
except Exception as e:
    print(f"âš ï¸ API ì„¤ì • ì˜¤ë¥˜: {e}")
    sys.exit()

# ---------------------------------------------------------
# 2. ì›¹ ìŠ¤í¬ë˜í•‘ ëª¨ë“ˆ (1ì°¨ ì‹œë„)
# ---------------------------------------------------------
def scrape_history_data(name):
    """
    êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒ DB í¬ë¡¤ë§ì„ ì‹œë„í•©ë‹ˆë‹¤.
    ì„±ê³µí•˜ë©´ í…ìŠ¤íŠ¸ë¥¼ ë°˜í™˜í•˜ê³ , ì‹¤íŒ¨í•˜ë©´ Noneì„ ë°˜í™˜í•©ë‹ˆë‹¤.
    """
    print(f"   ğŸ” 1ë‹¨ê³„: êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒ DBì—ì„œ '{name}' ê²€ìƒ‰ ì‹œë„...")

    base_url = "https://db.history.go.kr/search/searchResult.do"
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0 Safari/537.36',
        'Referer': 'https://db.history.go.kr/'
    }
    params = {'searchKeyword': name, 'limit': '20'}

    try:
        response = requests.get(base_url, params=params, headers=headers, timeout=5)

        if response.status_code != 200:
            return None # 404ë‚˜ 500 ì—ëŸ¬ ì‹œ ì‹¤íŒ¨ ì²˜ë¦¬

        soup = BeautifulSoup(response.text, 'html.parser')
        results = []

        # ì‚¬ì´íŠ¸ êµ¬ì¡°ì— ë§ëŠ” ì„ íƒì ì‹œë„
        list_items = soup.select('.search_list li .cont')
        if not list_items:
            list_items = soup.select('.result_list li')

        for item in list_items[:3]:
            text = item.get_text(strip=True)
            if len(text) > 30:
                results.append(text)

        if not results:
            return None # ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ

        return " ".join(results)

    except Exception:
        return None # ì—°ê²° ì‹œê°„ ì´ˆê³¼ ë“± ëª¨ë“  ì—ëŸ¬ ì‹œ ì‹¤íŒ¨ ì²˜ë¦¬

# ---------------------------------------------------------
# 3. ë¶„ë¥˜ ëª¨ë¸ ëª¨ë“ˆ (Gemini)
# ---------------------------------------------------------
def classify_figure(name, context_text=None):
    """
    Geminië¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ë¬¼ì„ ë¶„ë¥˜í•©ë‹ˆë‹¤.
    context_textê°€ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ê·¼ê±°ë¡œ(RAG), ì—†ìœ¼ë©´ Gemini ì§€ì‹ìœ¼ë¡œ(Fallback) ë¶„ì„í•©ë‹ˆë‹¤.
    """

    if context_text:
        # [Mode A] ìŠ¤í¬ë˜í•‘ ì„±ê³µ: ì œê³µëœ í…ìŠ¤íŠ¸ ê¸°ë°˜ ë¶„ì„
        print("   ğŸ¤– 2ë‹¨ê³„: ìˆ˜ì§‘ëœ ì‚¬ë£Œë¥¼ ë°”íƒ•ìœ¼ë¡œ ë¶„ì„ ì¤‘...")
        prompt = f"""
        ë‹¹ì‹ ì€ ì—­ì‚¬í•™ìì…ë‹ˆë‹¤. ì•„ë˜ [ì œê³µëœ ì‚¬ë£Œ]ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¸ë¬¼ '{name}'ì„ ë¶„ì„í•˜ì„¸ìš”.

        [ì œê³µëœ ì‚¬ë£Œ]
        {context_text[:2000]}

        ë°˜ë“œì‹œ 'ê°œí™”íŒŒ' ë˜ëŠ” 'ìœ„ì •ì²™ì‚¬íŒŒ' ì¤‘ í•˜ë‚˜ë¡œ ë¶„ë¥˜í•˜ê³ , ì‚¬ë£Œì— ë‚˜íƒ€ë‚œ ê·¼ê±°ë¥¼ ì œì‹œí•˜ì„¸ìš”.
        """
    else:
        # [Mode B] ìŠ¤í¬ë˜í•‘ ì‹¤íŒ¨: Gemini ìì²´ ì§€ì‹ ê¸°ë°˜ ë¶„ì„ (ìš°íšŒ)
        print("   ğŸš€ 2ë‹¨ê³„(ìš°íšŒ): ì›¹ ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨. Geminiì˜ ìì²´ ì§€ì‹ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤...")
        prompt = f"""
        ë‹¹ì‹ ì€ í•œêµ­ ê·¼ëŒ€ì‚¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì¸ë¬¼ '{name}'ì— ëŒ€í•´ ì•Œê³  ìˆëŠ” ì§€ì‹ì„ ë™ì›í•˜ì—¬ ì„±í–¥ì„ ë¶„ì„í•˜ì„¸ìš”.

        [ë¶„ì„ ìš”ì²­]
        1. ì´ ì¸ë¬¼ì´ **'ê°œí™”íŒŒ(Enlightenment Party)'**ì¸ì§€ **'ìœ„ì •ì²™ì‚¬íŒŒ(Orthodoxy Party)'**ì¸ì§€ ëª…í™•íˆ ë¶„ë¥˜í•˜ì„¸ìš”.
        2. ë§Œì•½ ë‘ íŒŒë²Œì— ì†í•˜ì§€ ì•Šê±°ë‚˜ ë…ë¦½ìš´ë™ê°€ë¼ë©´ 'ê¸°íƒ€/ì¤‘ë¦½'ìœ¼ë¡œ ë¶„ë¥˜í•˜ì„¸ìš”.
        3. íŒë‹¨ì˜ ê·¼ê±°ê°€ ë˜ëŠ” ì£¼ìš” ì—­ì‚¬ì  ì‚¬ê±´ì„ ì–¸ê¸‰í•˜ì„¸ìš”.
        """

    # ê³µí†µ ì¶œë ¥ í˜•ì‹ ìš”ì²­
    prompt += """

    [ì¶œë ¥ í˜•ì‹]
    - **ë¶„ë¥˜**: [ê°œí™”íŒŒ / ìœ„ì •ì²™ì‚¬íŒŒ / ê¸°íƒ€]
    - **ë¶„ì„ ëª¨ë“œ**: [ì‚¬ë£Œ ê¸°ë°˜ ë¶„ì„ / AI ì§€ì‹ ê¸°ë°˜ ë¶„ì„]
    - **í•µì‹¬ ê·¼ê±°**: [í•œ ë¬¸ì¥ ìš”ì•½]
    """

    try:
        response = model.generate_content(prompt)
        return response.text
    except Exception as e:
        return f"âš ï¸ API í˜¸ì¶œ ì˜¤ë¥˜: {e}"

# ---------------------------------------------------------
# 4. ë©”ì¸ ì‹¤í–‰
# ---------------------------------------------------------
def main():
    print("\n" + "="*60)
    print("   ğŸ›ï¸  ì—­ì‚¬ ì¸ë¬¼ ì„±í–¥ ë¶„ë¥˜ê¸° (í•˜ì´ë¸Œë¦¬ë“œ ë²„ì „)   ")
    print("      (ì›¹ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ AI ì§€ì‹ìœ¼ë¡œ ìë™ ì „í™˜ë¨)")
    print("="*60)

    while True:
        target_name = input("\nğŸ“ ì¸ë¬¼ ì´ë¦„ ì…ë ¥ ('q' ì¢…ë£Œ): ").strip()

        if target_name.lower() == 'q':
            print("í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
            break

        if not target_name:
            continue

        print("-" * 60)

        # 1. ìŠ¤í¬ë˜í•‘ ì‹œë„
        history_context = scrape_history_data(target_name)

        if not history_context:
            print(f"   âš ï¸ ì•Œë¦¼: êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒì—ì„œ '{target_name}' ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í•˜ê±°ë‚˜ ì ‘ê·¼ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.")

        # 2. ë¶„ë¥˜ (ì»¨í…ìŠ¤íŠ¸ ìœ ë¬´ì— ë”°ë¼ ë‚´ë¶€ ë¡œì§ì´ ë‹¬ë¼ì§)
        result = classify_figure(target_name, history_context)

        print("-" * 60)
        print(f"ğŸ“Š [ê²°ê³¼ ë¦¬í¬íŠ¸]: {target_name}")
        print(result)
        print("=" * 60)

if __name__ == "__main__":
    main()
