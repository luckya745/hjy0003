# -*- coding: utf-8 -*-
"""ì„¸ê³„ì‚¬ ì¸ë¬¼ ê²€ìƒ‰ê¸°(ìœ„í‚¤ë°±ê³¼ ì›¹ìŠ¤í¬ë˜í•‘).ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1IbzB_GgzIfsPUZH0R-mlNxMoY9lfGsX_
"""

pip install google-generativeai requests beautifulsoup4

import requests
from bs4 import BeautifulSoup
import google.generativeai as genai
import urllib.parse  # í•œê¸€ URL ì²˜ë¦¬ë¥¼ ìœ„í•œ ëª¨ë“ˆ ì¶”ê°€

def get_wiki_text(name):
    """
    ìœ„í‚¤ë°±ê³¼ì—ì„œ í•´ë‹¹ ì¸ë¬¼ì˜ í˜ì´ì§€ í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    """
    base_url = "https://ko.wikipedia.org/wiki/"

    # [ìˆ˜ì • 1] í•œê¸€ ì´ë¦„ì„ URL ì „ìš© ë¬¸ìì—´ë¡œ ë³€í™˜ (ì˜ˆ: ë‚˜í´ë ˆì˜¹ -> %EB%82%98...)
    encoded_name = urllib.parse.quote(name)
    url = base_url + encoded_name

    # [ìˆ˜ì • 2] ìœ„í‚¤ë°±ê³¼ê°€ ë´‡ì„ ì°¨ë‹¨í•˜ì§€ ì•Šë„ë¡ 'User-Agent' í—¤ë” ì¶”ê°€
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
    }

    try:
        # headers ì •ë³´ë¥¼ í•¨ê»˜ ì „ì†¡
        response = requests.get(url, headers=headers)

        # í˜ì´ì§€ê°€ ì—†ê±°ë‚˜ ì˜¤ë¥˜ê°€ ë‚˜ë©´ None ë°˜í™˜
        if response.status_code != 200:
            print(f"âš ï¸ ì ‘ì† ì˜¤ë¥˜ ì½”ë“œ: {response.status_code}") # ë””ë²„ê¹…ìš© ì¶œë ¥
            return None

        soup = BeautifulSoup(response.text, 'html.parser')

        # ë³¸ë¬¸ ë‚´ìš©ì´ ìˆëŠ” divë§Œ ì„ íƒ
        content_div = soup.find('div', {'class': 'mw-parser-output'})

        if content_div:
            text = content_div.get_text()
            return text[:5000]
        return None

    except Exception as e:
        print(f"ì›¹ ìŠ¤í¬ë˜í•‘ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
        return None

def analyze_with_gemini(api_key, name, wiki_text):
    """
    Gemini APIë¥¼ í˜¸ì¶œí•˜ì—¬ í…ìŠ¤íŠ¸ì—ì„œ ì •ë³´ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
    """
    # API í‚¤ ì„¤ì •
    genai.configure(api_key=api_key)

    # ëª¨ë¸ ì„¤ì •
    model = genai.GenerativeModel('gemini-2.5-flash')

    # í”„ë¡¬í”„íŠ¸ ì‘ì„±
    prompt = f"""
    ë‹¹ì‹ ì€ ì—­ì‚¬ êµìœ¡ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì•„ë˜ ì œê³µëœ ìœ„í‚¤ë°±ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì½ê³ 
    '{name}'ë¼ëŠ” ì¸ë¬¼ì— ëŒ€í•œ ì •ë³´ë¥¼ ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•´ ì£¼ì„¸ìš”.

    [ì¶œë ¥ í˜•ì‹]
    êµ­ì : (êµ­ì  ì •ë³´, í™•ì‹¤í•˜ì§€ ì•Šìœ¼ë©´ 'ì •ë³´ ì—†ìŒ'ìœ¼ë¡œ í‘œê¸°)
    ì£¼ìš” í™œë™: (ì´ ì¸ë¬¼ì´ ì—­ì‚¬ì ìœ¼ë¡œ ì–´ë–¤ ì¼ì„ í–ˆëŠ”ì§€ ì¤‘í•™ìƒì´ ì´í•´í•˜ê¸° ì‰½ê²Œ 3ë¬¸ì¥ ë‚´ì™¸ë¡œ ìš”ì•½)

    [ìœ„í‚¤ë°±ê³¼ í…ìŠ¤íŠ¸]
    {wiki_text}
    """

    try:
        response = model.generate_content(prompt)
        return response.text
    except Exception as e:
        return f"AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}"

# --- ë©”ì¸ ì‹¤í–‰ ë¶€ë¶„ ---
if __name__ == "__main__":
    print("=== AI ê¸°ë°˜ ìœ„í‚¤ë°±ê³¼ ì¸ë¬¼ ë¶„ì„ê¸° (Gemini API) ===")

    user_api_key = input("Google AI Studio API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”: ").strip()

    if not user_api_key:
        print("API Keyê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
        exit()

    print("\nâœ… ì„¤ì • ì™„ë£Œ! ì¸ë¬¼ ê²€ìƒ‰ì„ ì‹œì‘í•©ë‹ˆë‹¤. (ì¢…ë£Œ: q)")

    while True:
        target_name = input("\nì¸ë¬¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì´ìˆœì‹ , ë‚˜í´ë ˆì˜¹): ").strip()

        if target_name.lower() == 'q':
            print("í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
            break

        if not target_name:
            continue

        print(f"ğŸ” '{target_name}' ìœ„í‚¤ë°±ê³¼ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...")

        # ìŠ¤í¬ë˜í•‘ ì‹œë„
        raw_text = get_wiki_text(target_name)

        if raw_text is None:
            print(f"âŒ '{target_name}' ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            print("   (íŒ: ì •í™•í•œ ë„ì–´ì“°ê¸°ë‚˜ ê³µì‹ í‘œì œì–´ë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”. ì˜ˆ: 'ë‚˜í´ë ˆì˜¹ ë³´ë‚˜íŒŒë¥´íŠ¸')")
        else:
            print(f"ğŸ¤– Geminiê°€ '{target_name}'ì— ëŒ€í•´ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...")
            result = analyze_with_gemini(user_api_key, target_name, raw_text)

            print("-" * 50)
            print(f"ğŸ“Œ ì¸ë¬¼: {target_name}")
            print(result.strip())
            print("-" * 50)

import google.generativeai as genai
import streamlit as st  # ì´ ì¤„ì´ ì—†ìœ¼ë©´ ë§¨ ìœ„ì— ì¶”ê°€í•´ì£¼ì„¸ìš”!

# ì´ì œ ì‹¤ì œ í‚¤ ëŒ€ì‹  'ë¹„ë°€ ê¸ˆê³ 'ë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤
GOOGLE_API_KEY = st.secrets["GEMINI_API_KEY"]
genai.configure(api_key=GOOGLE_API_KEY)


print("=== ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ ëª©ë¡ ===")
for m in genai.list_models():
    # 'generateContent' ê¸°ëŠ¥(ì±„íŒ…/í…ìŠ¤íŠ¸ ìƒì„±)ì´ ìˆëŠ” ëª¨ë¸ë§Œ ì¶œë ¥
    if 'generateContent' in m.supported_generation_methods:
        print(m.name)
